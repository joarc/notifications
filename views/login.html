<!DOCTYPE html>
<html lang="en">
  <head>
%#meta#%
    <title>Login - N!</title>
%#css#%
    <link href="/css/signin.css" rel="stylesheet">
  </head>
  <body>
    <div class="container">
      <div class="alert alert-danger alert-dismissible hidden" id="login-error">
        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
        <span class="glyphicon glyphicon-minus-sign"></span>
         Login Failed: Incorrect username or password!
      </div>
      <div class="alert alert-danger alert-dismissible hidden" id="notloggedin">
        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
        <span class="glyphicon glyphicon-warning-sign"></span>
         You cannot view that page: You are not logged in!
      </div>
      <div class="alert alert-info alert-dismissible hidden" id="logged-out">
        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
        <span class="glyphicon glyphicon-log-out"></span>
         You successfully logged out.
      </div>
      <div class="alert alert-success alert-dismissible hidden" id="registration-success">
        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
        <span class="glyphicon glyphicon-log-out"></span>
         Registration successful! You can now sign in!
      </div>
      <form class="form-signin" id="login" method="post" action="/login">
        <h2 class="form-signin-heading"><span class="glyphicon glyphicon-log-in"></span> Please sign in</h2>
        <div class="form-group">
          <label for="username">Username:</label>
          <input type="text" id="username" class="form-control" placeholder="Username" name="username" required autofocus>
        </div>
        <div class="form-group">
          <label for="password">Password:</label>
          <input type="password" id="password" class="form-control" placeholder="Password" name="password" required>
        </div>
        <button class="btn btn-lg btn-primary btn-block" type="button" onclick="login();">Sign in</button>
        <br><br>
        <h4 class="text-center"><a href="/register">Don't have an account? Sign Up!</a></h4>
        <br>
        <h4 class="text-center"><a href="/">Back to Home <span class="glyphicon glyphicon-home"></span></a></h4>
      </form>
    </div>
%#js#%
    <script>
    var type = window.location.hash.substr(1);
    if (type == "loggedout") {
      $("#logged-out").removeClass("hidden");
    } else if (type == "registration-success") {
      $("#registration-success").removeClass("hidden");
    } else if (type == "notloggedin") {
      $("#notloggedin").removeClass("hidden");
    }
    $("#login input").keypress(function(e){
      if (e.which == 13){
        login();
      }
    })
    function login(){
      var loginusername = $("#username").val();
      var loginpassword = $("#password").val();
      //var logindata = JSON.stringify({username: loginusername, password: loginpassword});
      var logindata = {username: loginusername, password: loginpassword};
      $("#login-password").val(null);
      $.ajax({url: "/login", method: "POST", dataType: "json", data: logindata}).always(function(res){
        console.log(res);
        if (res.success) {
          window.location.href = "/dashboard";
        } else {
          $("#login-error").removeClass("hidden").hide();
          $("#login-error").text(res.msg);
          $("#login-error").fadeIn(1000, function(){
            setTimeout(function(){
              $("#login-error").fadeOut(2000);
            }, 4000);
          });
        }
      });
    }
    </script>
  </body>
</html>
